# Dataset and Model Training Guide

This guide explains how to download datasets, set up the folder structure, and train ML models for threat-aware autoscaling in Kubernetes.

## Table of Contents
- [Datasets Required](#datasets-required)
- [Folder Structure](#folder-structure)
- [Prerequisites](#prerequisites)
- [Setup Instructions](#setup-instructions)
- [Training Models](#training-models)
- [Model Files](#model-files)

---

## Datasets Required

This project uses three different datasets for training anomaly detection models across different versions:

### 1. CSIC 2010 HTTP Dataset (for v1 models)
- **Description**: Web application attack dataset containing normal and anomalous HTTP traffic
- **Download**: [CSIC 2010 HTTP Dataset](http://www.isi.csic.es/dataset/)
- **Size**: ~100 MB
- **Location**: `datasets/csic-2010/`
- **Files needed**:
  - `training_normal.csv` - Normal HTTP traffic for training
  - `testing_mixed.csv` - Mixed benign and attack traffic for testing

### 2. CIC-IDS2018 Dataset (for v2 models)
- **Description**: Comprehensive intrusion detection dataset with multiple attack types
- **Download**: [CIC-IDS2018 on Kaggle](https://www.kaggle.com/datasets/solarmainframe/ids-intrusion-csv) or [Official CSE-CIC-IDS2018](https://www.unb.ca/cic/datasets/ids-2018.html)
- **Size**: ~6-7 GB (16M+ rows)
- **Location**: `datasets/cic-ids2018/`
- **Files**: Multiple CSV files containing network traffic data
- **Attack Types**: Brute Force, DoS, DDoS, Web attacks, Infiltration, Botnet

### 3. BCCC-cPacket Cloud DDoS 2024 Dataset (for v3 models)
- **Description**: Recent cloud-based DDoS attack dataset
- **Download**: [IEEE DataPort - BCCC-cPacket Cloud DDoS 2024](https://ieee-dataport.org/documents/bccc-cpacket-cloud-ddos-2024)
- **Size**: Variable (check dataset page)
- **Location**: `datasets/BCCC-cPacket-Cloud-DDoS-2024/`
- **Files**: Network traffic CSVs with DDoS attack patterns

---

## Folder Structure

```
ML-based-Threat-aware-Auto-scaling-in-Kubernetes/
│
├── datasets/                          # All datasets (gitignored)
│   ├── csic-2010/                     # CSIC 2010 dataset for v1
│   │   ├── training_normal.csv
│   │   ├── testing_mixed.csv
│   │   ├── train_features.csv         # Generated by feature_extraction.py
│   │   ├── test_features.csv          # Generated by feature_extraction.py
│   │   └── test_labels.csv            # Generated by feature_extraction.py
│   │
│   ├── cic-ids2018/                   # CIC-IDS2018 dataset for v2
│   │   ├── *.csv                      # Raw CSV files from dataset
│   │   └── processed/
│   │       └── splits/
│   │           ├── train_features.csv # Generated by split_dataset_efficient.py
│   │           ├── test_features.csv
│   │           └── test_labels.csv
│   │
│   └── BCCC-cPacket-Cloud-DDoS-2024/  # BCCC dataset for v3
│       ├── *.csv                      # Raw CSV files
│       └── processed/                 # Generated processed files
│
├── src/
│   ├── data_processing/
│   │   ├── README.md
│   │   ├── v1/                        # CSIC 2010 processing
│   │   │   ├── feature_extraction.py
│   │   │   └── split_dataset.py
│   │   │
│   │   └── v2/                        # CIC-IDS2018 processing
│   │       ├── explore_data.py
│   │       ├── feature_selection.py
│   │       ├── feature_selection_efficient.py
│   │       ├── split_dataset.py
│   │       └── split_dataset_efficient.py
│   │
│   └── models/
│       ├── README.md
│       ├── v1/                        # Models trained on CSIC 2010
│       │   ├── train_autoencoder.py
│       │   ├── train_gmm.py
│       │   ├── train_isolation_forest.py
│       │   ├── train_knn.py
│       │   └── train_one_class_svm.py
│       │
│       ├── v2/                        # Models trained on CIC-IDS2018
│       │   ├── train_autoencoder.py
│       │   ├── train_gmm.py
│       │   ├── train_isolation_forest.py
│       │   ├── train_knn.py
│       │   ├── train_one_class_svm.py
│       │   ├── evaluate_gmm_balanced.py
│       │   ├── evaluate_isolation_forest_balanced.py
│       │   └── evaluate_knn_balanced.py
│       │
│       └── v3/                        # Models trained on BCCC-2024
│           ├── README.md
│           ├── train_autoencoder.py
│           ├── train_gmm.py
│           ├── train_isolation_forest.py
│           ├── train_knn.py
│           └── train_one_class_svm.py
│
├── results/                           # Training results (gitignored)
│   ├── models/                        # v1 trained models
│   │   ├── autoencoder_model.h5
│   │   ├── autoencoder_scaler.pkl
│   │   ├── autoencoder_threshold.pkl
│   │   ├── gmm_model.pkl
│   │   ├── isolation_forest_model.pkl
│   │   ├── knn_model.pkl             # Large file (~100+ MB)
│   │   └── one_class_svm_model.pkl
│   │
│   ├── v2/                            # v2 model results
│   │   ├── gmm_model.pkl
│   │   ├── isolation_forest_model.pkl
│   │   └── knn_model.pkl             # Very large (~1.2 GB)
│   │
│   └── v3/                            # v3 model results
│       └── (similar structure)
│
├── .gitignore                         # Excludes datasets, models, results
├── IMPLEMENTATION_GUIDE.md
├── RESULTS_SUMMARY.md
├── DATA_README.md                     # This file
└── README.md

```

---

## Prerequisites

### Software Requirements
- **Python**: 3.8 or higher
- **pip**: Latest version
- **Virtual Environment**: Recommended for dependency isolation

### Python Libraries
Install all dependencies:
```bash
pip install pandas numpy scikit-learn tensorflow keras joblib matplotlib seaborn
```

Or use requirements.txt if available:
```bash
pip install -r requirements.txt
```

### System Requirements
- **RAM**: Minimum 16 GB (recommended 32 GB for CIC-IDS2018)
- **Storage**: At least 20 GB free space for datasets and models
- **CPU**: Multi-core processor recommended for faster training

---

## Setup Instructions

### Step 1: Clone the Repository
```bash
git clone https://github.com/SanjayaWeerasinghe/ML-based-Threat-aware-Auto-scaling-in-Kubernetes.git
cd ML-based-Threat-aware-Auto-scaling-in-Kubernetes
```

### Step 2: Create Virtual Environment
```bash
python3 -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
```

### Step 3: Install Dependencies
```bash
pip install --upgrade pip
pip install pandas numpy scikit-learn tensorflow keras joblib matplotlib seaborn
```

### Step 4: Create Dataset Folders
```bash
mkdir -p datasets/csic-2010
mkdir -p datasets/cic-ids2018
mkdir -p datasets/BCCC-cPacket-Cloud-DDoS-2024
```

### Step 5: Download and Place Datasets

#### For CSIC 2010:
1. Download from [CSIC 2010 website](http://www.isi.csic.es/dataset/)
2. Extract and convert to CSV format
3. Place files in `datasets/csic-2010/`:
   - `training_normal.csv`
   - `testing_mixed.csv`

#### For CIC-IDS2018:
1. Download from [Kaggle](https://www.kaggle.com/datasets/solarmainframe/ids-intrusion-csv)
2. Extract all CSV files
3. Place in `datasets/cic-ids2018/`

#### For BCCC-cPacket 2024:
1. Download from [IEEE DataPort](https://ieee-dataport.org/documents/bccc-cpacket-cloud-ddos-2024)
2. Extract CSV files
3. Place in `datasets/BCCC-cPacket-Cloud-DDoS-2024/`

---

## Training Models

### V1 Models (CSIC 2010 Dataset)

1. **Prepare Features**:
```bash
cd src/data_processing/v1
python feature_extraction.py
```
This generates:
- `datasets/csic-2010/train_features.csv`
- `datasets/csic-2010/test_features.csv`
- `datasets/csic-2010/test_labels.csv`

2. **Train Models**:
```bash
cd ../../models/v1

# Train individual models
python train_autoencoder.py
python train_gmm.py
python train_isolation_forest.py
python train_knn.py
python train_one_class_svm.py
```

### V2 Models (CIC-IDS2018 Dataset)

1. **Prepare Dataset** (Memory-Efficient):
```bash
cd src/data_processing/v2
python split_dataset_efficient.py
```
This processes 16M+ rows in chunks and generates:
- `datasets/cic-ids2018/processed/splits/train_features.csv`
- `datasets/cic-ids2018/processed/splits/test_features.csv`
- `datasets/cic-ids2018/processed/splits/test_labels.csv`

2. **Optional - Feature Selection**:
```bash
python feature_selection_efficient.py
```

3. **Train Models**:
```bash
cd ../../models/v2

# Train with memory optimization (2.5M samples)
python train_autoencoder.py
python train_gmm.py
python train_isolation_forest.py
python train_knn.py            # WARNING: Produces very large file (~1.2 GB)
python train_one_class_svm.py
```

4. **Evaluate with Balanced Metrics**:
```bash
python evaluate_gmm_balanced.py
python evaluate_isolation_forest_balanced.py
python evaluate_knn_balanced.py
```

### V3 Models (BCCC-cPacket 2024 Dataset)

1. **Prepare Dataset**:
Follow similar data processing steps as v2 (adapt scripts if needed)

2. **Train Models**:
```bash
cd src/models/v3

python train_autoencoder.py
python train_gmm.py
python train_isolation_forest.py
python train_knn.py
python train_one_class_svm.py
```

---

## Model Files

### File Types and Sizes

| Model Type | File Extension | Typical Size | Notes |
|------------|---------------|--------------|-------|
| Autoencoder | `.h5` | 1-5 MB | Keras model |
| GMM | `.pkl` | 10-50 MB | Gaussian Mixture Model |
| Isolation Forest | `.pkl` | 50-200 MB | Tree-based ensemble |
| KNN | `.pkl` | **100 MB - 1.2 GB** | ⚠️ Very large! Stores all training samples |
| One-Class SVM | `.pkl` | 100-500 MB | Support vectors |
| Scalers | `.pkl` | <1 MB | StandardScaler objects |
| Thresholds | `.pkl` | <1 KB | Optimal threshold values |

### Why Models Are Not in Git Repository

**Model files are excluded from the repository because:**
1. **Size Constraints**: GitHub has a 100 MB file limit
2. **KNN Models**: Can exceed 1 GB (especially v2 trained on 2.5M samples)
3. **Reproducibility**: Anyone can train models using the provided scripts
4. **Dataset Licensing**: Original datasets should be obtained from official sources

### Trained Model Locations

After training, models are saved to:
- **v1 models**: `results/models/`
- **v2 models**: `results/models/v2/`
- **v3 models**: `results/models/v3/`

---

## Performance Benchmarks

### Training Time Estimates (on 16GB RAM, 8-core CPU)

| Model | V1 (CSIC) | V2 (CIC-IDS2018) | V3 (BCCC-2024) |
|-------|-----------|------------------|----------------|
| Autoencoder | 5-10 min | 30-60 min | Variable |
| GMM | 2-5 min | 15-30 min | Variable |
| Isolation Forest | 3-7 min | 10-20 min | Variable |
| KNN | 10-20 min | **2-4 hours** | Variable |
| One-Class SVM | 15-30 min | **4-8 hours** | Variable |

**Note**: V2 training times are significantly longer due to larger dataset (2.5M training samples)

---

## Troubleshooting

### Memory Issues
- **Problem**: Out of memory errors during training
- **Solution**: Reduce `TRAIN_SAMPLE_SIZE` and `TEST_SAMPLE_SIZE` in training scripts
- **Default v2 values**: 2.5M training, 250K test (optimized for 16GB RAM)

### Dataset Not Found
- **Problem**: `FileNotFoundError` when running scripts
- **Solution**: Verify dataset paths match the folder structure above
- **Check**: Run `ls datasets/` to confirm dataset directories exist

### Large Model Files
- **Problem**: KNN models are too large (>1 GB)
- **Solution**: This is normal - KNN stores all training samples
- **Alternative**: Use Isolation Forest or GMM for similar performance with smaller file size

### Missing Dependencies
- **Problem**: `ModuleNotFoundError`
- **Solution**: Ensure virtual environment is activated and all packages installed:
```bash
pip install pandas numpy scikit-learn tensorflow keras joblib
```

---

## Citation & License

### Datasets
If you use these datasets in research, please cite the original sources:

**CSIC 2010**:
```
CSIC 2010 HTTP Dataset
Information Security Institute of CSIC (Spanish Research National Council)
```

**CIC-IDS2018**:
```
Sharafaldin, I., Lashkari, A.H., Ghorbani, A.A.
"Toward Generating a New Intrusion Detection Dataset and Intrusion Traffic Characterization"
4th International Conference on Information Systems Security and Privacy (ICISSP), 2018
```

**BCCC-cPacket 2024**:
```
BCCC-cPacket Cloud DDoS 2024 Dataset
IEEE DataPort
```

---

## Support

For issues or questions:
- **GitHub Issues**: [Report Issues](https://github.com/SanjayaWeerasinghe/ML-based-Threat-aware-Auto-scaling-in-Kubernetes/issues)
- **Documentation**: See `IMPLEMENTATION_GUIDE.md` and `RESULTS_SUMMARY.md`

---

**Last Updated**: January 2026
**Author**: SanjayaWeerasinghe
